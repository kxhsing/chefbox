{% extends 'base.html' %}

{% block title %}Search Recipe{% endblock %}

{% block content %}

    <h2>Search for a Recipe</h2>

    {% if not user.ingredients %}
      <p>Add ingredients to include in search:</p>
      <form action="/add_ingred" method="POST" id="new-ingred">
        <input type="text" name="ingredient" id="new-ingredient">
        <input type="submit" value="Add">
      </form>

    {% endif %}

    {% if user.ingredients %}
    <p>Add ingredient to search query:</p>
      <form action="/add_ingred" method="POST" id="add-ingred">
        <input type="text" name="ingredient" id="ingredient">
        <input type="submit" value="Add">
      </form>
    {% endif %}

    <form action="/request_recipe" method="POST">
      {% if user.ingredients %}
        <p>Include Ingredients from Inventory:</p>
        <ul id="ingred-list">
          {% for ingredient in user.ingredients %}
              <li><input type="checkbox" name="search_ingredients" value="{{ ingredient.ingred_name }}" checked>{{ ingredient.ingred_name.title() }}</li>
          {% endfor %}
        </ul>
        
      {% else %}
      <ul id="new-ingred-list">
      </ul>

      {% endif %}<br>

          Preferred Cuisine(s)<br>
          (optional):<br>
            <ul>
            {% for cuisine in cuisines %}
                <li><input type="checkbox" name="cuisines" value="{{ cuisine }}">{{ cuisine.title() }}</li>
            {% endfor %}
            </ul><br>


          Dietary Restrictions: 
          <select name="diet">
            <option value="">None</option><br>
            {% for diet in diets %}
            <option value="{{ diet }}">{{ diet.title() }}</option><br>
            {% endfor %}
          </select><br>

          <p></p>

          Allergies or Intolerances: 
            <ul>
            {% for intolerance in intolerances %}
                <li><input type="checkbox" name="intolerances" value="{{ intolerance }}">{{ intolerance.title() }}</li>
            {% endfor %}
            </ul><br>
        <input type="submit" value="Search">
        </form>



    <script>

    //if user has ingredients in inventory but want to add more before submitting recipe search query
      function ingredAddResult(result) {
        console.log(result);
        var ingredList = $("#ingred-list");
        var ingredientName = result.ingredient;
        if (ingredientName) {
        var ingredID = result.ingred_id;
        console.log(ingredID);
        ingredList[0].innerHTML = ingredList.html() + '<li><input type="checkbox" name="search_ingredients" value="'+ingredientName+'" checked>'+ingredientName+'</li>';
        alert("Added to inventory and search query: "+ingredientName);
        }
      else {
        alert("Ingredient exists already");
        };
      }

      function addIngred(evt) {
        evt.preventDefault();

        var formInputs = {
          "ingredient": $("#ingredient").val()
        };

        $.post("/add_ingred", formInputs, ingredAddResult);
      }

      $("#add-ingred").on("submit", addIngred);


    //if no ingredients in inventory and want to add ingredients to search
      function newIngredAddResult(result) {
      console.log(result);
      var ingredList = $("#new-ingred-list");
      var ingredientName = result.ingredient;
      if (ingredientName) {
      var ingredID = result.ingred_id;
      console.log(ingredID);
      ingredList[0].innerHTML = ingredList.html() + '<li><input type="checkbox" name="search_ingredients" value="'+ingredientName+'" checked>'+ingredientName+'</li>';
      alert("Added to inventory and search query: "+ingredientName);
      }
      else {
        alert("Ingredient exists already");
        };
    }

    function addNewIngred(evt) {
      evt.preventDefault();

      var formInputs = {
        "ingredient": $("#new-ingredient").val()
      };

      $.post("/add_ingred", formInputs, newIngredAddResult);
    }

    $("#new-ingred").on("submit", addNewIngred);




   </script>






{% endblock %}




