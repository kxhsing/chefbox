{% extends 'base.html' %}

{% block title %}Recipe Results{% endblock %}

{% block content %}

    <h2>Recipe Results</h2>

    {% if recipe_results_list %}
      <p>Save a recipe to import it into your recipe box. <br>
        Saved recipes will include recipe name, ingredients, ingredient units and measurements, instructions, and source URL.</p>
          {% for recipe in recipe_results_list %}
            <table>
                  <tr>
                    <th>{{ recipe[1].title() }}</th>
                  </tr>
                    <tr>
                      <td> <img src="{{ recipe[4] }}" class="search-result-photo"> </td>
                    </tr>
                    <tr>
                      <td> via {% if recipe[3] and recipe[2] %}<a href="{{ recipe[3]}}" target="_blank"> {{ recipe[2] }} </a> 
                              {% elif recipe[3] %}
                                <a href="{{ recipe[3]}}" target="_blank"> [Original Source] </a> 
                              {% else %} 
                                {{ recipe[2] }}
                              {% endif %}
                          </td>
                    </tr>
                    <tr>
                      <td>Ingredients<br>
                        <ul>
                        {% for ingredient in recipe[6] %}
                            <li>{{ ingredient }}</li>
                        {% endfor %}
                      </ul>
                      </td>
                    </tr>
                      <tr>
                        <td>Instructions<br>
                          <ol>
                          {% for instruction in recipe[5] %}
                              <li>{{ instruction }}</li>
                          {% endfor %}
                        </ol>
                        </td>
                      </tr>
                    <tr>
                      <td>
                      <form action="/add_recipe" method="POST">
                            <button type="submit" class="add-recipe" name="recipe_id" value="{{ recipe[0] }}">Save Recipe</button>
                      </form>
                      </td>
                    </tr>
              </table>
              <p></p>
            {% endfor %}

      {% if total_results > 10 and session['offset'] < 900 %}
          <form action="/search_more" method="POST">
                <button type="submit" name="more_results" value="10">More Results</button>
          </form>
      {% endif %}

    {% else %}
      <p>We couldn't find a recipe with the parameters you specified. Please search again.</p>

    {% endif %}

  <p><a href="/search_recipe">New Recipe Search</a></p>


  <script>

       function addRecipe(evt) {
          evt.preventDefault();
          // debugger
          var thisButton = this;
          var thisTable = $(thisButton).parentsUntil("table");


          var formInputs = {
            "recipe_id": this.value
          };


          $.post("/add_recipe", formInputs, function(){

            alert("Recipe saved!");
            $(thisTable).fadeOut();


          });
        }

        $(".add-recipe").on('click', addRecipe);



  </script>


{% endblock %}




